<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>2-Port Network Calculator (S, Y, Z, ABCD)</title>
  <!-- MathJax for LaTeX 수식 렌더링 -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <!-- math.js for complex & matrix 연산 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f8f9fa;
      padding: 20px;
      text-align: center;
    }
    h1 { color: #2c3e50; margin-bottom: 20px; }
    .input-group { margin: 10px 0; }
    label {
      display: inline-block;
      width: 100px;
      text-align: right;
      margin-right: 10px;
      font-weight: 500;
    }
    select, input {
      width: 120px;
      padding: 5px;
      text-align: right;
    }
    .complex-inputs {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin: 15px 0;
    }
    .io-group {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .io-group label { text-align: left; width: auto; margin: 0; }
    .result-box, .formula-box {
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      max-width: 700px;
      text-align: left;
    }
    .result-box h3, .formula-box h3 {
      margin-top: 0;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
      color: #2c3e50;
    }
    .result-box p, .formula-box p {
      margin: 6px 0;
      font-size: 15px;
    }
    button {
      margin: 10px 5px;
      padding: 10px 20px;
      font-size: 16px;
      background: #1abc9c;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>2-포트 파라미터 변환기</h1>

  <div class="input-group">
    <label for="inputType">입력 형식:</label>
    <select id="inputType">
      <option value="S">S-파라미터</option>
      <option value="Z">Z-파라미터</option>
      <option value="Y">Y-파라미터</option>
      <option value="ABCD">ABCD 매트릭스</option>
    </select>
  </div>

  <div class="input-group">
    <label for="outputType">출력 형식:</label>
    <select id="outputType">
      <option value="S">S-파라미터</option>
      <option value="Z">Z-파라미터</option>
      <option value="Y">Y-파라미터</option>
      <option value="ABCD">ABCD 매트릭스</option>
    </select>
  </div>

  <div class="input-group">
    <label for="z0">Z₀ (Ω):</label>
    <input type="number" id="z0" value="50">
  </div>

  <div class="complex-inputs" id="paramInputs">
    <!-- JavaScript가 여기에 4개 param 그룹을 생성합니다 -->
  </div>

  <button onclick="convert()">계산하기</button>

  <div class="result-box" id="result"></div>

  <div class="formula-box">
    <h3>사용된 수식</h3>
    <p><strong>입력 → S 변환:</strong><br>
      S = (Z – Z₀I)·(Z + Z₀I)⁻¹  <em>(Z 입력 시)</em><br>
      S = (Z(Y) – Z₀I)·(Z(Y) + Z₀I)⁻¹  <em>(Y 입력 시, Z(Y)=Y⁻¹)</em><br>
      S = [A + B/Z₀ – C·Z₀ – D] / Δ  <em>(ABCD 입력 시)</em><br>
      S₂₁ = 2/Δ, S₁₂ = 2(AD–BC)/Δ, Δ = A + B/Z₀ + C·Z₀ + D
    </p>
    <p><strong>S → Z:</strong><br>
      Z = Z₀·(I + S)·(I – S)⁻¹
    </p>
    <p><strong>Z → Y:</strong><br>
      Y = Z⁻¹
    </p>
    <p><strong>Z → ABCD:</strong><br>
      A = Z₁₁/Z₂₁,  B = det(Z)/Z₂₁,  C = 1/Z₂₁,  D = Z₂₂/Z₂₁
    </p>
  </div>

  <script>
    const paramMap = {
      S: ['S11','S12','S21','S22'],
      Z: ['Z11','Z12','Z21','Z22'],
      Y: ['Y11','Y12','Y21','Y22'],
      ABCD: ['A','B','C','D']
    };

    // 파라미터 입력 필드 동적 생성
    function setupInputs() {
      const container = document.getElementById('paramInputs');
      container.innerHTML = '';
      const type = document.getElementById('inputType').value;
      paramMap[type].forEach(name => {
        const group = document.createElement('div');
        group.className = 'io-group';
        group.innerHTML = `
          <label>${name} Re:</label>
          <input id="${name}r" type="number" value="0">
          <label>${name} Im:</label>
          <input id="${name}i" type="number" value="0">
        `;
        container.appendChild(group);
      });
    }

    document.getElementById('inputType').addEventListener('change', setupInputs);
    window.addEventListener('load', setupInputs);

    // 입력 파라미터를 복소수 행렬 S로 변환
    function getSfromInput() {
      const Z0 = parseFloat(document.getElementById('z0').value);
      const type = document.getElementById('inputType').value;
      const names = paramMap[type];
      // 입력 행렬
      const vals = names.map(n => math.complex(
        parseFloat(document.getElementById(n + 'r').value),
        parseFloat(document.getElementById(n + 'i').value)
      ));
      // 2x2 행렬 형태
      const M = math.matrix([[vals[0], vals[1]], [vals[2], vals[3]]]);
      const I = math.identity(2);

      if (type === 'S') {
        return M;
      }
      if (type === 'Z') {
        return math.multiply(
          math.subtract(M, math.multiply(Z0, I)),
          math.inv(math.add(M, math.multiply(Z0, I)))
        );
      }
      if (type === 'Y') {
        const Z = math.inv(M);
        return math.multiply(
          math.subtract(Z, math.multiply(Z0, I)),
          math.inv(math.add(Z, math.multiply(Z0, I)))
        );
      }
      if (type === 'ABCD') {
        const [A,B,C,D] = vals;
        const Δ = math.add(
          math.add(A, math.divide(B, Z0)),
          math.add(math.multiply(C, Z0), D)
        );
        const S11 = math.divide(math.subtract(math.subtract(A, D),
                     math.add(math.divide(B,Z0), math.multiply(C,Z0))), Δ);
        const S21 = math.divide(2, Δ);
        const S12 = math.divide(math.multiply(2, math.subtract(math.multiply(A,D), math.multiply(B,C))), Δ);
        const S22 = math.divide(math.add(math.subtract(D, A),
                     math.subtract(math.divide(B,Z0), math.multiply(C,Z0))), Δ);
        return math.matrix([[S11, S12],[S21, S22]]);
      }
    }

    // S 행렬 → 원하는 출력 형태로 변환
    function convert() {
      const Z0 = parseFloat(document.getElementById('z0').value);
      const S = getSfromInput();
      const I = math.identity(2);
      // Z로 변환
      const Z = math.multiply(Z0, math.multiply(math.add(I,S), math.inv(math.subtract(I,S))));
      // Y로 변환
      const Y = math.inv(Z);
      // ABCD로 변환
      const Z11 = Z.get([0,0]), Z12 = Z.get([0,1]),
            Z21 = Z.get([1,0]), Z22 = Z.get([1,1]);
      const detZ = math.subtract(math.multiply(Z11,Z22), math.multiply(Z12,Z21));
      const A = math.divide(Z11, Z21),
            B = math.divide(detZ, Z21),
            C = math.divide(1, Z21),
            D = math.divide(Z22, Z21);
      // 출력 행렬 선택
      const outType = document.getElementById('outputType').value;
      let M;
      if (outType === 'S')       M = S;
      else if (outType === 'Z')  M = Z;
      else if (outType === 'Y')  M = Y;
      else                        M = math.matrix([[A,B],[C,D]]);

      // 결과 표시
      const names = paramMap[outType];
      let html = `<h3>${outType}-parameters</h3>`;
      const vals = [M.get([0,0]), M.get([0,1]), M.get([1,0]), M.get([1,1])];
      vals.forEach((c,i) => {
        html += `<p>${names[i]} = ${math.re(c).toFixed(4)} + j${math.im(c).toFixed(4)}</p>`;
      });
      document.getElementById('result').innerHTML = html;
    }
  </script>

</body>
</html>
