<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2-Port Network Calculator (S, Y, Z, ABCD)</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f8f9fa;
      padding: 20px;
      text-align: center;
    }
    h1 { color: #2c3e50; margin-bottom: 20px; text-align: center; }
    .input-group { margin: 10px 0; }
    label {
      display: inline-block;
      width: 130px;
      text-align: center;
      margin-right: 10px;
      font-weight: 500;
    }
    select, input {
      width: 150px;
      padding: 5px;
      text-align: center;
    }
    .complex-inputs {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin: 15px 0;
    }
    .io-group {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      min-width: 120px;
    }
    .io-group label {
      text-align: center;
      margin: 0;
    }
    .result-box, .formula-box {
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      max-width: 700px;
      text-align: center;
    }
    .result-box h3, .formula-box h3 {
      margin-top: 0;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
      color: #2c3e50;
    }
    .result-box p, .formula-box p {
      margin: 6px 0;
      font-size: 15px;
    }
    button {
      margin: 10px 5px;
      padding: 10px 20px;
      font-size: 16px;
      background: #1abc9c;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>2-Port Parameter Converter</h1>

  <div class="input-group">
    <label for="inputType">Input Format:</label>
    <select id="inputType">
      <option value="S">S-parameters</option>
      <option value="Z">Z-parameters</option>
      <option value="Y">Y-parameters</option>
      <option value="ABCD">ABCD Matrix</option>
    </select>
  </div>

  <div class="input-group">
    <label for="outputType">Output Format:</label>
    <select id="outputType">
      <option value="S">S-parameters</option>
      <option value="Z">Z-parameters</option>
      <option value="Y">Y-parameters</option>
      <option value="ABCD">ABCD Matrix</option>
    </select>
  </div>

  <div class="input-group">
    <label for="z0">Z₀ (Ω):</label>
    <input type="number" id="z0" value="50">
  </div>

  <div class="complex-inputs" id="paramInputs">
    <!-- JS creates parameter input fields here -->
  </div>

  <button onclick="convert()">Convert</button>

  <div class="result-box" id="result"></div>

  <div class="formula-box">
    <h3>Formulas Used</h3>
    <p><strong>To S from other parameters:</strong><br>
      \( S = (Z - Z_0 I)(Z + Z_0 I)^{-1} \quad \text{(from Z)} \)<br>
      \( S = (Z(Y) - Z_0 I)(Z(Y) + Z_0 I)^{-1} \quad \text{(from Y, where } Z(Y) = Y^{-1}) \)<br>
      \( S = \frac{A + B/Z_0 - C Z_0 - D}{A + B/Z_0 + C Z_0 + D} \quad \text{(from ABCD)} \)
    </p>
    <p><strong>S to Z:</strong><br>
      \( Z = Z_0 (I + S)(I - S)^{-1} \)
    </p>
    <p><strong>Z to Y:</strong><br>
      \( Y = Z^{-1} \)
    </p>
    <p><strong>Z to ABCD:</strong><br>
      \( A = Z_{11}/Z_{21}, \quad B = \det(Z)/Z_{21}, \quad C = 1/Z_{21}, \quad D = Z_{22}/Z_{21} \)
    </p>
  </div>

  <script>
    const paramMap = {
      S: ['S11','S12','S21','S22'],
      Z: ['Z11','Z12','Z21','Z22'],
      Y: ['Y11','Y12','Y21','Y22'],
      ABCD: ['A','B','C','D']
    };

    function setupInputs() {
      const container = document.getElementById('paramInputs');
      container.innerHTML = '';
      const type = document.getElementById('inputType').value;
      paramMap[type].forEach(name => {
        const group = document.createElement('div');
        group.className = 'io-group';
        group.innerHTML = `
          <label>${name} Re:</label>
          <input id="${name}r" type="number" value="0">
          <label>${name} Im:</label>
          <input id="${name}i" type="number" value="0">
        `;
        container.appendChild(group);
      });
    }

    document.getElementById('inputType').addEventListener('change', setupInputs);
    window.addEventListener('load', setupInputs);

    function getSfromInput() {
      const Z0 = parseFloat(document.getElementById('z0').value);
      const type = document.getElementById('inputType').value;
      const names = paramMap[type];
      const vals = names.map(n => math.complex(
        parseFloat(document.getElementById(n + 'r').value),
        parseFloat(document.getElementById(n + 'i').value)
      ));
      const M = math.matrix([[vals[0], vals[1]], [vals[2], vals[3]]]);
      const I = math.identity(2);

      if (type === 'S') return M;
      if (type === 'Z') return math.multiply(
        math.subtract(M, math.multiply(Z0, I)),
        math.inv(math.add(M, math.multiply(Z0, I)))
      );
      if (type === 'Y') {
        const Z = math.inv(M);
        return math.multiply(
          math.subtract(Z, math.multiply(Z0, I)),
          math.inv(math.add(Z, math.multiply(Z0, I)))
        );
      }
      if (type === 'ABCD') {
        const [A,B,C,D] = vals;
        const Δ = math.add(
          math.add(A, math.divide(B, Z0)),
          math.add(math.multiply(C, Z0), D)
        );
        const S11 = math.divide(math.subtract(math.subtract(A, D),
                     math.add(math.divide(B,Z0), math.multiply(C,Z0))), Δ);
        const S21 = math.divide(2, Δ);
        const S12 = math.divide(math.multiply(2, math.subtract(math.multiply(A,D), math.multiply(B,C))), Δ);
        const S22 = math.divide(math.add(math.subtract(D, A),
                     math.subtract(math.divide(B,Z0), math.multiply(C,Z0))), Δ);
        return math.matrix([[S11, S12],[S21, S22]]);
      }
    }

    function convert() {
      const Z0 = parseFloat(document.getElementById('z0').value);
      const S = getSfromInput();
      const I = math.identity(2);
      const Z = math.multiply(Z0, math.multiply(math.add(I,S), math.inv(math.subtract(I,S))));
      const Y = math.inv(Z);
      const Z11 = Z.get([0,0]), Z12 = Z.get([0,1]),
            Z21 = Z.get([1,0]), Z22 = Z.get([1,1]);
      const detZ = math.subtract(math.multiply(Z11,Z22), math.multiply(Z12,Z21));
      const A = math.divide(Z11, Z21),
            B = math.divide(detZ, Z21),
            C = math.divide(1, Z21),
            D = math.divide(Z22, Z21);
      const outType = document.getElementById('outputType').value;
      let M;
      if (outType === 'S')       M = S;
      else if (outType === 'Z')  M = Z;
      else if (outType === 'Y')  M = Y;
      else                       M = math.matrix([[A,B],[C,D]]);

      const names = paramMap[outType];
      let html = `<h3>${outType}-parameters</h3>`;
      const vals = [M.get([0,0]), M.get([0,1]), M.get([1,0]), M.get([1,1])];
      vals.forEach((c,i) => {
        html += `<p>${names[i]} = ${math.re(c).toFixed(4)} + j${math.im(c).toFixed(4)}</p>`;
      });
      document.getElementById('result').innerHTML = html;
    }
  </script>
</body>
</html>
